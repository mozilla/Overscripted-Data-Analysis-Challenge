/**
 * Package www/core
 * lmd/module/acces-non-abonne
 * lmd/core/auth
 * lmd/core/storage
 * lmd/core/service
 * lmd/core/conf
 * lmd/core/context
 * lmd/core/live
 * lmd/core/social/facebook
 * lmd/core/social/twitter
 * lmd/core/ux/widget-position
 * lmd/module/xiti/hit
 */

/* -- start module lmd/module/acces-non-abonne -- */
define("lmd/module/acces-non-abonne",["lmd/core/auth"],function(n){"use strict";function o(n){window.location+""!==n&&(window.location=n)}function t(){n.loadUser().then(function(){var t=n.user;"abonnes"===lmd.context.application&&"abonne"!==t.type&&n.logout().then(function(){var n=window.location.protocol+"//"+lmd.conf.www.location.hostname;o(window.location.pathname.indexOf("/article/")>1?n+"/teaser/?connexion&url_zop="+encodeURIComponent(n):n+"/teaser/presentation.html#connexion&url_zop="+encodeURIComponent(n))})})}return{init:t}});
/* -- end module lmd/module/acces-non-abonne -- */
/* -- start module lmd/core/auth -- */
define("lmd/core/auth",["jquery","lmd/core/storage","lib/jquery/plugin/jquery.cookie","lmd/core/service"],function($,e,r,t){"use strict";function s(){var r=e.get(i.user);return r?r.user?r.user:r.id?(o.user=r,o._putInCache(),r):null:null}var i={user:"user",journalist:"journalistes",newsletters:"user_newsletters",cla:"cla"},o={RELOAD_CLA_TIME:864e5,NEWSLETTERS_STORAGE_KEY:i.newsletters,COOKIE_USER_ID:"tdb_user_id",COOKIE_NEW_USER_ID:"lmd_a_s",COOKIE_NEW_USER_MAIL:"lmd_a_m",COOKIE_NEW_USER_PREMIUM:"lmd_a_sp",COOKIE_ALM:"alm",COOKIE_WORDPRESS:"wordpress_domain",COOKIE_EDUCATION:"educ_partenaires",user:null,_loadUserDeferred:null,_loadUserServicesDeferred:null,authenticated:!1,checkAuthentication:function(){return this.authenticated=null!==$.cookie(this.COOKIE_USER_ID)||null!==$.cookie(this.COOKIE_NEW_USER_MAIL),this.authenticated===!1&&this.clearCache(),this.authenticated},refresh:function(){return this.loadUser(!0)},update:function(){this._putInCache()},login:function(e,r){var s={};return"boolean"==typeof r&&(s.dataType="jsonp"),t.get("auth/login",1,e,s)},register:function(e,r){var s={};return"boolean"==typeof r&&(s.dataType="jsonp"),t.get("auth/register",1,e,s)},confirm:function(e,r){var s={};return"boolean"==typeof r&&(s.dataType="jsonp"),t.get("auth/confirmation",1,e,s)},resetPassword:function(e,r){var s={};return"boolean"==typeof r&&(s.dataType="jsonp"),t.get("auth/password/reset",1,e,s)},changePassword:function(e,r){var s={};return"boolean"==typeof r&&(s.dataType="jsonp"),t.get("auth/password/change",1,e,s)},logout:function(){return this.clearCache(),t.get("auth/logout",1,null,{dataType:"jsonp"}).done($.proxy(this.clearCache,this))},loadUser:function(r){var i=!1;if((null===this._loadUserDeferred||r)&&(this._loadUserDeferred=$.Deferred(),i=!0),(null===this._loadUserServicesDeferred||r)&&(this._loadUserServicesDeferred=$.Deferred()),null===$.cookie(this.COOKIE_USER_ID)&&null!==$.cookie(this.COOKIE_NEW_USER_MAIL)){t.get("auth/legacy/sso",1,null,{dataType:"jsonp"}).done($.proxy(this._loadUserLegacyCallback,this))}if(this.checkAuthentication(),this.authenticated&&(i||r)){if(e.isSupported&&!r){var n=s();if(null!==n){var a=this._getUserIdAlm();if(n.id==a||null===a)return n.newId=this._getNewUserId(),this.user=n,this._loadUserDeferred.resolve(),!$.cookie(this.COOKIE_WORDPRESS)&&o.user.services.indexOf("blog")?this.majServices(!0):this._loadUserServicesDeferred.resolve(),this._loadUserDeferred.promise()}}t.get("auth/user",1,null,{dataType:"jsonp"}).done($.proxy(this._loadUserCallback,this)),this.majServices(!0)}return this.authenticated||(this._loadUserDeferred.resolve(),this._loadUserServicesDeferred.resolve()),this._loadUserDeferred.promise()},majServices:function(r){if(e.isSupported){var s=e.get(i.cla);if(s&&Date.now()<=s+this.RELOAD_CLA_TIME)return this._loadUserServicesDeferred.promise();e.set(i.cla,Date.now(),2*this.RELOAD_CLA_TIME,!1)}if(!r)return this.loadUser(r),this._loadUserServicesDeferred.promise();t.get("sfuser/sfws/auth/user",0,null,{dataType:"jsonp"}).done($.proxy(this._claUserCallback,this))},clearCache:function(){e.remove(i.user),e.remove(i.journalist),e.remove(i.newsletters),e.remove(i.cla)},isUserEducation:function(){return this.checkAuthentication()&&$.cookie(this.COOKIE_EDUCATION)},getUserFirstNameInitials:function(){return this.user&&this.user.prenom?this.user.prenom.split(/(-| )/).map(function(e){return e.length>1?e.charAt(0)+".":e}).join("").replace(" "," "):""},_userIsPremium:function(){return!!$.cookie(this.COOKIE_NEW_USER_PREMIUM)||!!$.cookie(this.COOKIE_ALM)},_getUserIdAlm:function(){var e=$.cookie(this.COOKIE_ALM);if(null===e)return null;var r=e.split("-");return r.length>2?parseInt(r[r.length-2]):null},_getNewUserId:function(){return $.cookie(this.COOKIE_NEW_USER_ID)},_loadUserLegacyCallback:function(e){"object"==typeof e&&e.result&&window.location.reload()},_claUserCallback:function(e){"object"==typeof e?(this._userIsPremium()&&"undefined"!=typeof e.premium&&!e.premium&&window.location.hostname.indexOf("abonnes")>-1&&(window.location.href=window.location.href.replace(/abonnes/,"www")),this._loadUserServicesDeferred.resolve()):this._loadUserServicesDeferred.reject()},_loadUserCallback:function(e){"object"==typeof e&&"object"==typeof e.user?(e.user.newId=this._getNewUserId(),this.user=e.user,this._putInCache(),this._loadUserDeferred.resolve()):this._loadUserDeferred.reject()},_putInCache:function(){e.isSupported&&e.set(i.user,{user:this.user},18e5,!1)}};return o.authenticated=o.checkAuthentication(),o});
/* -- end module lmd/core/auth -- */
/* -- start module lmd/core/storage -- */
define("lmd/core/storage",["jquery","lmd/core/conf","lib/jquery/plugin/jquery.cookie"],function($,e,t){"use strict";$.cookie=t;var o={isSupported:!1,get:function(e,t){var o,r;if(this.isSupported)try{r=window.localStorage.getItem(e),null!==r&&t!==!0||(r=window.sessionStorage.getItem(e)),o=JSON.parse(r)}catch(e){return null}else o=JSON.parse(this._getNoStorage(e));if(!o)return null;if(void 0!==o.timeout){var i=(new Date).getTime(),n=parseInt(o.timeout,10)-i;if(n<0)return this.remove(e),null}return void 0===o.data?null:o.data},set:function(e,t,o,r){var i={};i.data=t,"undefined"!=typeof o&&$.isNumeric(o)&&(i.timeout=(new Date).getTime()+o);var n=JSON.stringify(i);if(this.isSupported){try{"undefined"!=typeof o&&r===!0?window.sessionStorage.setItem(e,n):window.localStorage.setItem(e,n)}catch(e){return!1}return!0}return this._setNoStorage(e,n,o)},remove:function(e,t){return this.isSupported?t?(window.sessionStorage.removeItem(e),!0):(window.sessionStorage.removeItem(e),window.localStorage.removeItem(e),!0):this._removeNoStorage(e)},_setNoStorage:function(t,o,r){if(void 0===$.cookie)return!1;var i={path:"/",domain:"."+e.current.location.domain};if("number"==typeof r){var n=Math.floor(r/36e5);n>0&&(i.expires=Math.floor(r/36e5))}return $.cookie("storage_"+t,o,i),!0},_getNoStorage:function(e){return"undefined"!=typeof $.cookie&&$.cookie("storage_"+e)},_removeNoStorage:function(e){return"undefined"!=typeof $.cookie&&($.cookie("storage_"+e,null),!0)}};return o.isSupported=function(){try{return null!==window.sessionStorage&&null!==window.localStorage}catch(e){return!1}}(),o});
/* -- end module lmd/core/storage -- */
/* -- start module lmd/core/service -- */
define("lmd/core/service",["jquery","lmd/core/conf"],function($,e){"use strict";return{get:function(o,t,n,r){"undefined"==typeof r&&(r={}),"undefined"==typeof r.timeout&&(r.timeout=5e3),"undefined"==typeof r.dataType&&(r.dataType="json");var a="string"==typeof r.dataType&&"jsonp"===r.dataType;if(o.replace(/^\/?(.*)\/?$/,"$1"),0===t)var i="/"+o+"/";else var i="/ws/"+t+"/"+o+"/";if(a===!0&&(i="https:"!==window.location.protocol?window.location.protocol+"//"+e.www.location.hostname+i:window.location.protocol+"//"+e.www.location.hostname+i),r.data=n,r.url=i,a===!0){var c=$.Deferred();return $.ajax(r).then(function(e){"object"!=typeof e||"object"==typeof e.error?c.reject(e):c.resolve(e)},c.reject),c}return $.ajax(r)}}});
/* -- end module lmd/core/service -- */
/* -- start module lmd/core/conf -- */
define("lmd/core/conf",function(){"use strict";if("undefined"==typeof lmd||"undefined"==typeof lmd.conf)return null;var n,o=function(n,e){var f;"undefined"!=typeof n.hostname&&(n.domain=n.hostname.match(/[\-\w]+\.fr$/),n.domain=n.domain?n.domain[0]:"",e.app=n.hostname.match(/([\-\w]+)\.[\-\w]+\.fr$/),e.app=e.app?e.app[1]:"");for(f in n)"object"==typeof n[f]&&o(n[f],n)};return o(lmd.conf),n=window.location.hostname.match(/\.?([\-a-z]+[^\-org])(-org)?\.lemonde[\-a-z]*\.fr$/),lmd.conf.current=lmd.conf.www,n&&"object"==typeof lmd.conf[n[1]]&&(lmd.conf.current=lmd.conf[n[1]]),lmd.conf.search_hash="2139JDJ12J3",lmd.conf});
/* -- end module lmd/core/conf -- */
/* -- start module lmd/core/context -- */
define("lmd/core/context",function(require){"use strict";var e=(require("lmd/module/capping-sensibilisation"),require("lmd/core/conf"),!1),i=!1,n={PAGE_TYPE_UNE:"Rubrique_Une",PAGE_TYPE_UNE_ABONNES:"Rubrique_Une_Abonnes",PAGE_TYPE_RUBRIQUE:"Rubrique",PAGE_TYPE_RUBRIQUE_TYPEITEM:"Rubrique_TypeItem",PAGE_TYPE_RUBRIQUE_BLOGS:"Rubrique_Blogs",PAGE_TYPE_ELEMENT:"Element",PAGE_TYPE_ANNALES_BAC:"Element",PAGE_TYPE_OTHER:"Autre",pageType:null,rubrique:null,item:null,element:null,page:null,init:function(){if("undefined"==typeof window.lmd||"undefined"==typeof window.lmd.context)return!1;var i=window.lmd.context;this.application=i.application,this.pageType=i.pageType,this.rubrique=i.rubrique,this.item=i.item,this.element=i.element,this.page=i.page,this._initCurrentPage(),e=!0},_initCurrentPage:function(){this.page.link=window.location.pathname},getTopmostSection:function(){return!(!e||null===this.rubrique)&&(this.rubrique.parents.length?this.rubrique.parents[this.rubrique.parents.length-1].url_friendly:this.rubrique.url_friendly)},getSectionNameList:function(){if(!e)return[];if(i)return i;var n,r,t;for(i=[],i.push(this.rubrique.url_friendly),n=0,r=this.rubrique.parents.length;n<r;n++)i.indexOf(this.rubrique.parents[n].url_friendly)===-1&&i.push(this.rubrique.parents[n].url_friendly);if(t=this.rubriques||window.lmd.context.rubriques)for(n=0,r=t.length;n<r;n++)i.indexOf(t[n].url_friendly)===-1&&i.push(t[n].url_friendly);return i}};return n.init(),n});
/* -- end module lmd/core/context -- */
/* -- start module lmd/core/live -- */
define("lmd/core/live",["jquery","lmd/core/conf"],function($,t){"use strict";var s=null,i=$("<div></div>"),n={status:"stopped",interval:3,stop:function(){this.status="stopped",null!==s&&(window.clearInterval(s),s=null)},start:function(i){("started"!==this.status||i&&this.interval!==i)&&("started"===this.status&&this.stop(),this.interval=i||t.live.interval||this.interval,s=window.setInterval(this.pool,1e3*this.interval),this.status="started",this.pool())},pool:function(){return $.ajax({url:"http://"+t.live.location.hostname+"/mux.json",dataType:"script",cache:!0})},success:function(t){this.trigger("success.start"),t.forEach(function(t){this.trigger(t.type,t.data)},this),this.trigger("success.end")},on:function(t,s,n){var e=n?$.proxy(s,n):s;return i.on(t,e),this},trigger:function(t,s){return i.trigger(t,s),this}};return window.live=function(t){n.success(t)},n});
/* -- end module lmd/core/live -- */
/* -- start module lmd/core/social/facebook -- */
define("lmd/core/social/facebook",["jquery","lmd/core/conf","lmd/core/context"],function($,e,t){"use strict";var i={_loadDeferred:null,parse:function(t){var i,n=$(".article .fb-like"),o=e.www.location.hostname;"undefined"!=typeof t.use_current_location&&t.use_current_location===!0&&(o=window.location.hostname),$(".fb-like").each(function(){var e=$(this).data("href");"undefined"==typeof e&&$(this).attr("data-href",window.location.protocol+"//"+o+window.location.pathname)}),FB.XFBML.parse(),FB.Event.subscribe("xfbml.render",function(){window.setTimeout(function(){n.first().css("overflow","visible").animate({opacity:"1"},200)},300)}),window.setTimeout(function(){i=n.first().find("iframe").css("height"),n.first().animate({height:i},200),n.last().css("height",i)},2e3)},partage:function(n,o){n=n||"",o=$.extend({link:!1,redirect_uri:window.location.protocol+"//"+e.www.location.hostname+t.page.link,xt:!1,use_current_location:!1},o),$(n).click(function(n){var r=o.link;if(r===!1){if("undefined"==typeof $(this).attr("data-href")||""===$(this).attr("data-href"))return;r=$(this).attr("data-href")}var a=e.www.location.hostname;o.use_current_location===!0&&(a=window.location.hostname),r.match(/^(https?:)?\/\//)||(r=window.location.protocol+"//"+a+r),"undefined"!=typeof xt_click&&o.xt!==!1&&xt_click(n.target,"C",t.page.xiti.xtn2,o.xt,"A"),i.load().done(function(){FB.ui({method:"feed",link:r,redirect_uri:o.redirect_uri})})})},load:function(){if(null!==this._loadDeferred&&"undefined"==typeof window.FB||(this._loadDeferred=$.Deferred()),"undefined"!=typeof window.FB)this._loadDeferred.resolve();else{var e=this._loadDeferred;window.fbAsyncInit=function(){FB.init({appId:"166878320861",status:!0,cookie:!0,xfbml:!0}),e.resolve()},$("body").append('<div id="fb-root"></div>'),function(e){var t,i="facebook-jssdk",n=e.getElementsByTagName("script")[0];e.getElementById(i)||(t=e.createElement("script"),t.id=i,t.async=!0,t.src="//connect.facebook.net/fr_FR/all.js",n.parentNode.insertBefore(t,n))}(document)}return this._loadDeferred.promise()}};return i});
/* -- end module lmd/core/social/facebook -- */
/* -- start module lmd/core/social/twitter -- */
define("lmd/core/social/twitter",["jquery","lib/jquery/plugin/jquery.spin","lmd/core/conf","lmd/core/context","lmd/ui/popup"],function($,t,e,r,i){"use strict";var o={_loadDeferred:null,_loadWidgetsDeferred:null,partage:function(t,o){t=t||"",o=$.extend({link:!1,title:!1,xt:!1,xtor:!1,use_popup:!0,width:550,height:320,position:"center",use_current_location:!1},o),$(t).click(function(t){var d,n=o.link,a=o.title,l="";if(n===!1){if("undefined"==typeof $(this).attr("data-href")||""===$(this).attr("data-href"))return;n=$(this).attr("data-href")}if(a===!1){if("undefined"==typeof $(this).attr("data-title")||""===$(this).attr("data-title"))return;a=$(this).attr("data-title")}d=e.www.location.hostname,o.use_current_location===!0&&(d=window.location.hostname),n.match(/^(https?:)?\/\//)||(n=window.location.protocol+"//"+d+n),"undefined"!=typeof xt_click&&o.xt!==!1&&xt_click(t.target,"C",r.page.xiti.xtn2,o.xt,"A"),n+="#xtor=AL-32280258",null===r.item.partenaire&&(l="&via=lemondefr"),n="//twitter.com/share?related=lemondefr&lang=fr&text="+encodeURI(a)+l+"&url="+encodeURI(n),o.use_popup===!0?i.openPopup({position:o.position,width:o.width,height:o.height,link:n}):window.location.href=n})},liste:function(t,e,r,i){var o=$("#"+t).get(0);twttr.widgets.load(o)},user:function(t,e,r){this.loadWidgets().done(function(){var r=$("#"+t).get(0);twttr.widgets.createTimeline("351705104409325570",r,function(t){},{screenName:e,lang:"fr",chrome:"noheader noborders noscrollbar",tweetLimit:4})})},load:function(){return(null===this._loadDeferred||$("body").data("twttr-rendered"))&&(this._loadDeferred=$.Deferred()),$("body").data("twttr-rendered")?this._loadDeferred.resolve():require(["twitter/widgets"],this._loadDeferred.resolve),this._loadDeferred.promise()},loadWidgets:function(){return null===this._loadWidgetsDeferred&&(this._loadWidgetsDeferred=$.Deferred()),"object"==typeof twttr&&twttr.init===!0&&"object"==typeof twttr.widgets&&twttr.widgets.loaded===!0?this._loadWidgetsDeferred.resolve():require(["twitter/widgets"],this._loadWidgetsDeferred.resolve),this._loadWidgetsDeferred.promise()}};return o});
/* -- end module lmd/core/social/twitter -- */
/* -- start module lmd/core/ux/widget-position -- */
define("lmd/core/ux/widget-position",function(require){"use strict";var $=require("jquery"),e=require("lmd/core/storage"),i=require("lmd/core/context"),r=require("domReady");require("lib/jquery/plugin/jquery.ajah");var u="";"undefined"!=typeof i.rubrique&&i.rubrique&&"undefined"!=typeof i.rubrique.rubrique_ombrelle&&i.rubrique.rubrique_ombrelle&&"undefined"!=typeof i.rubrique.rubrique_ombrelle.id&&i.rubrique.rubrique_ombrelle.id&&(u=i.rubrique.rubrique_ombrelle.id);var t=$("#widget_container"),n="widget-edito-display";return""!==u&&(n+=":"+u),{init:function(){1===t.length&&(this.canShowEditoWidget()?(this.showWidget(),this.increaseEditoWidgetDisplay()):r(function(){}))},showWidget:function(){t.ajah({url:t.data("uri")})},canShowEditoWidget:function(){if(e.isSupported===!1)return!0;var i=e.get(n,!0);return null===i||0===parseInt(i,10)},increaseEditoWidgetDisplay:function(){if(e.isSupported!==!1){var i=e.get(n,!0);null===i&&(i=0),e.set(n,i+1,null,!0)}}}});
/* -- end module lmd/core/ux/widget-position -- */
/* -- start module lmd/module/xiti/hit -- */
define("lmd/module/xiti/hit",function(){"use strict";var t=[],i=[],n=[],c=function(){"function"==typeof xt_click?xt_click.apply(this,arguments):t.push(arguments)},a=function(){"function"==typeof xt_adc?xt_adc.apply(this,arguments):i.push(arguments)},f=function(){"function"==typeof xt_adi?xt_adi.apply(this,arguments):n.push(arguments)},p=function(i){var n;for(n=0;n<t.length;n++)if(t[n].label===i)return!0;return!1},o=function(){var c;for(c=0;c<t.length;c++)xt_click.apply(this,t[c]);for(c=0;c<i.length;c++)xt_adc.apply(this,i[c]);for(c=0;c<n.length;c++)xt_adi.apply(this,n[c])};return{hit:c,adc:a,adi:f,has_hit:p,resolve:o}});
/* -- end module lmd/module/xiti/hit -- */